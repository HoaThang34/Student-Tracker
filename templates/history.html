{% extends "base.html" %}
{% block title %}L·ªãch S·ª≠ K·∫øt Qu·∫£{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-8">
    
    <div class="flex flex-col md:flex-row justify-between items-end gap-4">
        <div>
            <h1 class="text-3xl font-bold text-slate-800">üóÑÔ∏è Kho L∆∞u Tr·ªØ K·∫øt Qu·∫£</h1>
            <p class="text-slate-500 mt-1">Xem l·∫°i b·∫£ng ƒëi·ªÉm v√† x·∫øp h·∫°ng c·ªßa c√°c tu·∫ßn h·ªçc c≈©.</p>
        </div>

        <div class="flex items-center gap-3">
            <span class="text-sm font-medium text-slate-700">Ch·ªçn tu·∫ßn xem l·∫°i:</span>
            <form method="GET" action="{{ url_for('history') }}" class="relative">
                <i class="fas fa-calendar-check absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                <select name="week" onchange="this.form.submit()" 
                        class="pl-10 pr-8 py-2 bg-white border border-slate-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm font-bold text-indigo-700 cursor-pointer">
                    {% for w in weeks %}
                        <option value="{{ w }}" {% if w == selected_week %}selected{% endif %}>Tu·∫ßn {{ w }}</option>
                    {% else %}
                        <option value="">Ch∆∞a c√≥ d·ªØ li·ªáu c≈©</option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>

    {% if selected_week %}
    <div class="bg-white shadow-sm border border-slate-200 rounded-2xl overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2">
            <i class="fas fa-trophy text-yellow-500"></i>
            <h3 class="font-bold text-slate-700">B·∫£ng X·∫øp H·∫°ng Thi ƒêua (Tu·∫ßn {{ selected_week }})</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-100">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase">H·∫°ng</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase">L·ªõp</th>
                        <th class="px-6 py-3 text-right text-xs font-semibold text-slate-500 uppercase">ƒêi·ªÉm Tr·ª´</th>
                        <th class="px-6 py-3 text-right text-xs font-semibold text-slate-500 uppercase">ƒêi·ªÉm TB Tu·∫ßn</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-50 bg-white">
                    {% for cls in class_rankings %}
                    <tr class="hover:bg-slate-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if loop.index == 1 %}<span class="text-yellow-500 font-bold"><i class="fas fa-crown"></i> 1</span>
                            {% elif loop.index == 2 %}<span class="text-slate-400 font-bold">2</span>
                            {% elif loop.index == 3 %}<span class="text-orange-400 font-bold">3</span>
                            {% else %}<span class="text-slate-400">{{ loop.index }}</span>{% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-slate-800">{{ cls.name }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-red-500 font-medium">
                            {% if cls.weekly_deduct > 0 %}-{{ cls.weekly_deduct }}{% else %}0{% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right font-mono font-bold text-indigo-600">
                            {{ cls.avg_score }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="bg-white shadow-sm border border-slate-200 rounded-2xl overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
            <h3 class="font-bold text-slate-700">Chi Ti·∫øt ƒêi·ªÉm H·ªçc Sinh (ƒê√£ l∆∞u tr·ªØ)</h3>
            <span class="text-xs text-slate-500 italic">D·ªØ li·ªáu t·∫°i th·ªùi ƒëi·ªÉm k·∫øt th√∫c tu·∫ßn {{ selected_week }}</span>
        </div>
        <div class="overflow-x-auto max-h-[600px]">
            <table class="min-w-full divide-y divide-slate-100">
                <thead class="bg-slate-50 sticky top-0">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase">M√£ HS</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase">H·ªç T√™n</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase">L·ªõp</th>
                        <th class="px-6 py-3 text-right text-xs font-semibold text-slate-500 uppercase">ƒêi·ªÉm Ch·ªët</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-50 bg-white">
                    {% for row in archives %}
                    <tr class="hover:bg-slate-50">
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-slate-500 font-mono">{{ row.student_code }}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-slate-900">{{ row.student_name }}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-slate-600">
                            <span class="px-2 py-0.5 rounded bg-slate-100 border border-slate-200 text-xs font-bold">{{ row.student_class }}</span>
                        </td>
                        <td class="px-6 py-3 whitespace-nowrap text-right">
                            {% if row.final_score >= 90 %}
                                <span class="px-2 py-1 rounded bg-green-100 text-green-700 text-xs font-bold">{{ row.final_score }}</span>
                            {% elif row.final_score >= 70 %}
                                <span class="px-2 py-1 rounded bg-yellow-100 text-yellow-700 text-xs font-bold">{{ row.final_score }}</span>
                            {% else %}
                                <span class="px-2 py-1 rounded bg-red-100 text-red-700 text-xs font-bold">{{ row.final_score }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="text-center py-20 bg-white rounded-2xl border border-dashed border-slate-300">
        <i class="fas fa-history text-4xl text-slate-300 mb-4"></i>
        <p class="text-slate-500 font-medium">Ch∆∞a c√≥ d·ªØ li·ªáu l∆∞u tr·ªØ n√†o.</p>
        <p class="text-sm text-slate-400">D·ªØ li·ªáu s·∫Ω xu·∫•t hi·ªán sau khi b·∫°n th·ª±c hi·ªán "K·∫øt th√∫c tu·∫ßn".</p>
    </div>
    {% endif %}

</div>
{% endblock %}